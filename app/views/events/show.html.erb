<head>
  
  <title>Simple click event</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
    html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px
    }
  </style>
  
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
  
  <script>
  /* convert postcode to coordinates */
      var latitude = 0;
      var longitude = 0;
      var geocoder = new google.maps.Geocoder();
      var address = "<%=j @event.postcode %>;"
        geocoder.geocode({ 'address': address }, function (results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            latitude = results[0].geometry.location.lat();
            longitude = results[0].geometry.location.lng();
          };
        });
 /* end convert postcode to coordinates */
    
    function initialize() {
   
      var mapOptions = {
        zoom: 4,
        center: new google.maps.LatLng(latitude, longitude)
      };
      var map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);
      var marker = new google.maps.Marker({
        position: map.getCenter(),
        map: map,
        title: 'Click to zoom'
      });
      google.maps.event.addListener(map, 'center_changed', function() {
        // 3 seconds after the center of the map has changed, pan back to the
        // marker.
        window.setTimeout(function() {
          map.panTo(marker.getPosition());
        }, 3000);
      });
      google.maps.event.addListener(marker, 'click', function() {
        map.setZoom(8);
        map.setCenter(marker.getPosition());
      });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>

<body class="e_detail">

    <!-- To place image on the bar -->
    <div class="dropdownbarbox"></div>
    <br><br>

  <div class="container">
    <!-- Event name and logo row-->
    <div class="row">
      <div class="col-md-9">
       <h1> <%=@event.name %> </h1>
        
        <div class="stars">
          <%= render partial:'disable_rating', locals:{event: @event} %>
        </div>
        
       <h2> <%=@date %></h2>

      </div>
       <!--MAKE LOGO DYNAMIC-->
       <div class="col-md-3">
           <%= image_tag @event.ngo.avatar.url(), size: '100x100', class: 'float-right' %>  
      </div>

    </div><!--End Row Div-->  

    <!-- Button row-->
    <div class="row">
      <div class="col-md-12">
          <% if @event.past? %>
            <%= button_to "Historic Event", 'javascript:;', class: "btn btn-info"  %>
          <% elsif logged_in?%>
            <!-- sign up to an event -->
              <div class="events_signup">
                <%= render 'event_signup' %>
              </div>

              <div class="watch">
                <%= render 'watching_form'%>
              </div>

            <% else %>

              <%= button_to "Attend", login_path, class: "btn btn-primary col-md-1 il-button", method: :get  %>

              <%= button_to "Add to watchlist", login_path, class: "btn btn-primary col-md-1 il-button", method: :get  %>

            <% end %> 
      </div>
    </div><!--End Row Div-->  
    <br><br>
    <!--Event Descrtiption / Details Row--> 
    <div class="row">
      <!--Description Panel-->  
      <div class="col-md-8">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Event Description</strong></div>
            <div class="e_panel">
              <%=@event.description %>
            </div>     
        </div>
      </div>    

     <!-- Event Details-->


      <div class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading"><strong class="">Event Details</strong></div>
              <ul class="list-group">
                <li class="list-group-item text-right"><span class="pull-left"><strong class="">Event Date:</strong></span> <%=@date %> </li>
                <li class="list-group-item text-right"><span class="pull-left"><strong class="">Duration: </strong></span>[PENDING]</li>
                <li class="list-group-item text-right"><span class="pull-left"><strong class="">Event Creation Date:</strong></span><%=@event.created_at %></li>
            </ul>
          </div>
      </div>    
      </div><!--End Row Div-->

    <!--Video Row--> 
    <div class="row">

      <!--Map component-->
      <div class="col-md-6">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Event Location</strong></div>
            <div class="e_panel">
              <p id="today"></p>
              <div id="map-canvas" style="width:100%; height:300px;"></div>
            </div>
          
          <div class="panel-heading"><strong class="">Address</strong></div>
             <div class="e_panel">
               <p><%=@event.street %>  <%=@event.address %>,</p>
               <p><%=@event.location %>, <%=@event.postcode %></p>
            </div>

        </div>
      </div>

      <!--Video component-->  
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Event Video</strong></div>
            <div class="e_panel">
              <iframe width="100%" height="500px" src="<%= @event.url %>"></iframe>
            </div>
        </div>
      </div>

    </div><!--End Row Div-->  

    <!--Who is attending row-->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Who is attending?</strong></div>
            <div class="e_panel">
              <% $attending = 1 %>
              <% $row = 10 %>

              <% @event.volunteers.each do |e| %>
              <%= image_tag e.avatar.url(), size: '100x100',  style: 'padding: 5px; margin: 1px;' %>
              <% $attending += 1 %>
              <% end %>

              <% while $attending < $row  do %>
              <%= image_tag "https://img-w.zeebox.com/images/profile/generic/Empty_Profile_0#{$attending}.png:small", size: '100x100', style: 'padding: 5px; margin: 1px;' %>
              <% $attending += 1 %>
              <% end %>
            </div>
        </div>
      </div>
    </div><!--End Row Div-->  

      <!--Wall and Organiser Row--> 
    <div class="row">

     <!--Event Wall-->  
      <div class="col-sm-8">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Event Wall</strong></div>
            <div class="wall_posting e_panel">
              <%= render 'wall_posts' %>
            </div>
          </div>
        </div>

     <!--Score component-->
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Organiser Details</strong></div>
            <div class="e_panel">
              <div class="o-image">
                <%= image_tag @event.contact.url(), size: '100x100', class: 'o-image' %>
               </div>
                <p style ="text-align: center;"><%=@event.cname %></p>
                <p style ="text-align: center;"><%=@event.cemail %></p>

            </div>
        </div>
      </div>     

    </div><!--End Row Div-->  


    <!--Events in your area-->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading"><strong class="">Events in your areas</strong></div>
            <div class="e_panel">
            <% $count = 1 %>
            <% $max = 10 %>

            <% @event.events_in_area(@event.location) do |e| %>
            <%= image_tag e.avatar.url(), size: '100x100', style: 'padding: 5px; margin: 1px;' %>
            <% $count += 1 %>
            <% end %>

            <% while $count < $max  do %>
            <%= image_tag "https://img-w.zeebox.com/images/profile/generic/Empty_Profile_0#{$count}.png:small", size: '100x100', style: 'padding: 5px; margin: 1px;' %>
            <% $count += 1 %>
            <% end %>
            </div>
        </div>
      </div>
    </div><!--End Row Div-->  

    
  <!--End Container Div-->
  </div>
</body> 
